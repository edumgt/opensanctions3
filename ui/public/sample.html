<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì‚¬ì—…ê´€ë¦¬ ì‹œìŠ¤í…œ (ì´ìŠˆì¹´ë“œ íŒì—… ìˆ˜ì • + 3ì»¬ëŸ¼ ê³ ì •)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.2.1/styles/ag-grid.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.2.1/styles/ag-theme-alpine.css" />
<style>
body{margin:0;font-family:'Pretendard','Noto Sans KR',sans-serif;background:#f9fafc;display:flex;flex-direction:column;height:100vh;}
header{display:flex;justify-content:space-between;align-items:center;background:#1e293b;color:#fff;padding:12px 24px;}
.hamburger{font-size:22px;cursor:pointer;margin-right:20px;}
nav.gnb{display:flex;gap:32px;}
nav.gnb a{color:#cbd5e1;text-decoration:none;font-weight:500;}
nav.gnb a:hover,nav.gnb a.active{color:#fff;border-bottom:2px solid #60a5fa;padding-bottom:2px;}
aside{position:fixed;top:0;left:0;height:100%;width:240px;background:#f1f5f9;border-right:1px solid #e2e8f0;padding-top:70px;transform:translateX(-100%);transition:.3s;z-index:150;}
aside.active{transform:translateX(0);}
aside a{display:block;padding:12px 18px;color:#334155;text-decoration:none;border-left:4px solid transparent;}
aside a.active{background:#e0f2fe;border-left:4px solid #0ea5e9;font-weight:600;}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.3);display:none;z-index:100;}
.overlay.active{display:block;}
main{flex:1;padding:20px;overflow:auto;}
.search-box{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;background:#fff;padding:14px;border:1px solid #e2e8f0;border-radius:8px;margin-bottom:12px;}
.search-row{display:flex;align-items:center;gap:6px;}
.search-box label{font-size:13px;color:#374151;font-weight:500;min-width:60px;}
.search-box input,.search-box select{flex:1;padding:5px 8px;border:1px solid #cbd5e1;border-radius:4px;font-size:13px;}
.search-box button{background:#3b82f6;border:none;color:#fff;border-radius:4px;padding:6px 10px;cursor:pointer;}
.search-box button:hover{background:#2563eb;}
.column-toggle{background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:10px 14px;margin-bottom:14px;}
.column-toggle h4{font-size:14px;margin:0 0 8px;font-weight:600;color:#334155;}
.column-toggle .control-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.column-toggle input[type="text"]{flex:1;border:1px solid #cbd5e1;border-radius:4px;padding:5px 8px;font-size:13px;}
.column-toggle label{font-size:13px;margin-right:12px;display:inline-flex;align-items:center;gap:6px;margin-bottom:6px;}
.toggle-all{background:#2563eb;color:white;border:none;border-radius:4px;padding:4px 10px;cursor:pointer;font-size:13px;}
.toggle-all:hover{background:#1e40af;}
.ag-theme-alpine{height:calc(100vh - 340px);width:100%;}
.issue-btn{background:#0ea5e9;color:#fff;border:none;border-radius:4px;padding:4px 8px;cursor:pointer;font-size:12px;}
.issue-btn:hover{background:#0369a1;}
.status-blue{color:#0ea5e9;font-weight:600;}
.status-orange{color:#f97316;font-weight:600;}
.status-red{color:#e11d48;font-weight:600;}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;z-index:200;}
.modal.active{display:flex;}
.modal-content{background:#fff;border-radius:10px;padding:18px;width:720px;max-height:85vh;overflow:auto;box-shadow:0 10px 30px rgba(0,0,0,.18);}
.modal-content table{width:100%;border-collapse:collapse;margin-top:12px;}
.modal-content th,.modal-content td{border:1px solid #e5e7eb;padding:8px;text-align:left;font-size:13px;}
.modal-header{display:flex;justify-content:space-between;align-items:center;}
.modal-header h3{margin:0;font-size:18px;}
.modal-close{background:#2563eb;color:#fff;border:none;padding:6px 12px;border-radius:6px;cursor:pointer;}
</style>
</head>
<body>
<header>
  <div style="display:flex;align-items:center;">
    <span class="hamburger" id="menuToggle">â˜°</span>
    <strong>ì‚¬ì—…ê´€ë¦¬ ì‹œìŠ¤í…œ</strong>
  </div>
  <nav class="gnb">
    <a href="#" class="active">í˜‘ë ¥ì—…ì²´ê´€ë¦¬</a>
    <a href="#">ìˆ˜ì£¼ê´€ë¦¬</a>
    <a href="#">ì˜ˆì‚°ê´€ë¦¬</a>
    <a href="#">ì‚¬ì—…ê´€ë¦¬</a>
  </nav>
</header>

<aside id="sidebar">
  <a href="#" class="active">í”„ë¡œì íŠ¸ì™„ë£Œë³´ê³ </a>
  <a href="#">ì¤‘ì ì´ìŠˆëŒ€ìƒê´€ë¦¬</a>
</aside>
<div class="overlay" id="overlay"></div>

<main>
  <div class="search-box">
    <div class="search-row"><label>ë¶€ì„œ</label><select><option>ì „ì²´</option></select></div>
    <div class="search-row"><label>ì§„í–‰ìƒíƒœ</label><select><option>ì „ì²´</option></select></div>
    <div class="search-row"><label>ì˜ì—…ì±…ì„ì</label><input type="text"><button>ğŸ”</button></div>
    <div class="search-row"><label>ê²¬ì ì±…ì„ì</label><input type="text"><button>ğŸ”</button></div>
    <div class="search-row"><label>í”„ë¡œì íŠ¸</label><input type="text"><button>ğŸ”</button></div>
  </div>

  <div class="column-toggle">
    <h4>í‘œì‹œí•  ì»¬ëŸ¼ ì„ íƒ</h4>
    <div class="control-bar">
      <input type="text" id="colSearch" placeholder="ì»¬ëŸ¼ ê²€ìƒ‰..." />
      <button class="toggle-all" id="toggleCols">ì „ì²´ í•´ì œ</button>
    </div>
    <div id="columnToggles"></div>
  </div>

  <div id="myGrid" class="ag-theme-alpine"></div>
</main>

<div class="modal" id="issueModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>ì´ìŠˆì¹´ë“œ ìƒì„¸</h3>
      <button class="modal-close" onclick="closeModal()">ë‹«ê¸°</button>
    </div>
    <div id="issueBody"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/ag-grid-community@31.2.1/dist/ag-grid-community.min.js"></script>
<script>
const STORAGE_KEY="gridColumnVisibility_fixed";
const statusColors={ê³„ì•½ìŠ¹ì¸:"status-blue",ì˜ˆì‚°ìŠ¹ì¸:"status-orange",ì¢…ë£Œ:"status-red"};

const columnDefs=[
  {headerName:"ì‚¬ì—…ì‹¤",field:"ì‚¬ì—…ì‹¤",pinned:"left"},
  {headerName:"ì‚¬ì—…ë¶€ì„œ",field:"ì‚¬ì—…ë¶€ì„œ",pinned:"left"},
  {headerName:"PM",field:"PM",pinned:"left"},
  {headerName:"PJTëª…",field:"PJTëª…"},
  {headerName:"CODE",field:"CODE"},
  {
    headerName:"ì´ìŠˆì¹´ë“œ",field:"__issue__",
    cellRenderer:(params)=>{
      const dataStr=encodeURIComponent(JSON.stringify(params.data));
      return `<button class='issue-btn' onclick="openModal('${dataStr}')">ë³´ê¸°</button>`;
    }
  },
  {headerName:"ë°œì£¼ì²˜",field:"ë°œì£¼ì²˜"},
  {headerName:"ê³„ì•½ì‹œì‘ì¼",field:"ê³„ì•½ì‹œì‘ì¼"},
  {headerName:"ê³„ì•½ì¢…ë£Œì¼",field:"ê³„ì•½ì¢…ë£Œì¼"},
  {headerName:"ê³„ì•½ê¸ˆì•¡",field:"ê³„ì•½ê¸ˆì•¡"},
  {headerName:"ëˆ„ê³„ì²­êµ¬",field:"ëˆ„ê³„ì²­êµ¬"},
  {headerName:"ëˆ„ê³„ìˆ˜ê¸ˆ",field:"ëˆ„ê³„ìˆ˜ê¸ˆ"},
  {headerName:"ì§„ë„ìœ¨",field:"ì§„ë„ìœ¨"},
  {headerName:"ìƒíƒœ",field:"ìƒíƒœ",cellRenderer:p=>`<span class="${statusColors[p.value]||''}">${p.value||''}</span>`},
  {headerName:"ë¹„ê³ ",field:"ë¹„ê³ "}
];

const rowData=[
  {ì‚¬ì—…ì‹¤:"ë””ì§€í„¸í˜ì‹ ì‹¤",ì‚¬ì—…ë¶€ì„œ:"ì»¨ì„¤íŒ…ë³¸ë¶€",PM:"ì„ëŒ€ì›…",PJTëª…:"ëŒ€êµ¬í˜ì‹ êµ¬ ê³µí†µì„œë¹„ìŠ¤",CODE:"210052",ë°œì£¼ì²˜:"ëŒ€êµ¬ì‹œ",ê³„ì•½ì‹œì‘ì¼:"2021-02-25",ê³„ì•½ì¢…ë£Œì¼:"2024-12-31",ê³„ì•½ê¸ˆì•¡:1330,ëˆ„ê³„ì²­êµ¬:825,ëˆ„ê³„ìˆ˜ê¸ˆ:435,ì§„ë„ìœ¨:"59%",ìƒíƒœ:"ê³„ì•½ìŠ¹ì¸",ë¹„ê³ :"ì§€ì—° ì—†ìŒ"},
  {ì‚¬ì—…ì‹¤:"ê³µê³µë°ì´í„°ì‹¤",ì‚¬ì—…ë¶€ì„œ:"AIíŒ€",PM:"ì´ì¤€í˜",PJTëª…:"AI í•™ìŠµë¶„ì„ ì‹œìŠ¤í…œ",CODE:"210053",ë°œì£¼ì²˜:"êµìœ¡ë¶€",ê³„ì•½ì‹œì‘ì¼:"2022-01-01",ê³„ì•½ì¢…ë£Œì¼:"2023-12-31",ê³„ì•½ê¸ˆì•¡:2000,ëˆ„ê³„ì²­êµ¬:1100,ëˆ„ê³„ìˆ˜ê¸ˆ:950,ì§„ë„ìœ¨:"82%",ìƒíƒœ:"ì˜ˆì‚°ìŠ¹ì¸",ë¹„ê³ :"ê³ ê° í˜‘ì˜ ì¤‘"},
  {ì‚¬ì—…ì‹¤:"í–‰ì •ì •ë³´ì‹¤",ì‚¬ì—…ë¶€ì„œ:"ê³µê³µì‚¬ì—…íŒ€",PM:"ë°•ì§€í˜„",PJTëª…:"ìŠ¤ë§ˆíŠ¸ëŸ¬ë‹ í”Œë«í¼",CODE:"210054",ë°œì£¼ì²˜:"í–‰ì •ì•ˆì „ë¶€",ê³„ì•½ì‹œì‘ì¼:"2021-03-15",ê³„ì•½ì¢…ë£Œì¼:"2022-12-31",ê³„ì•½ê¸ˆì•¡:1580,ëˆ„ê³„ì²­êµ¬:1400,ëˆ„ê³„ìˆ˜ê¸ˆ:1380,ì§„ë„ìœ¨:"100%",ìƒíƒœ:"ì¢…ë£Œ",ë¹„ê³ :"-" }
];

const gridOptions={columnDefs,rowData,defaultColDef:{resizable:true,sortable:true,filter:true},onGridReady:onGridReady};

function onGridReady(){
  restoreColumnVisibility();
  createColumnToggles();
}

/* âœ… ì»¬ëŸ¼ í† ê¸€ UI */
function createColumnToggles(){
  const container=document.getElementById("columnToggles");
  container.innerHTML="";
  const cols=gridOptions.columnApi.getAllGridColumns();
  cols.forEach(col=>{
    const id=col.getColId(),name=col.getColDef().headerName||id;
    const label=document.createElement("label");
    const chk=document.createElement("input");
    chk.type="checkbox";chk.value=id;chk.checked=col.isVisible();
    chk.addEventListener("change",e=>{
      gridOptions.columnApi.setColumnVisible(id,e.target.checked);
      saveColumnVisibility();
    });
    label.appendChild(chk);label.append(" "+name);
    container.appendChild(label);
  });
}
document.getElementById("toggleCols").addEventListener("click",()=>{
  const checks=document.querySelectorAll("#columnToggles input[type='checkbox']");
  const anyChecked=[...checks].some(c=>c.checked);
  checks.forEach(c=>{c.checked=!anyChecked;gridOptions.columnApi.setColumnVisible(c.value,!anyChecked);});
  saveColumnVisibility();
  document.getElementById("toggleCols").textContent=anyChecked?"ì „ì²´ ì„ íƒ":"ì „ì²´ í•´ì œ";
});
document.getElementById("colSearch").addEventListener("input",e=>{
  const term=e.target.value.toLowerCase();
  document.querySelectorAll("#columnToggles label").forEach(lbl=>{
    lbl.style.display=lbl.textContent.toLowerCase().includes(term)?"inline-flex":"none";
  });
});
function saveColumnVisibility(){
  const vis={};gridOptions.columnApi.getAllGridColumns().forEach(c=>vis[c.getColId()]=c.isVisible());
  localStorage.setItem(STORAGE_KEY,JSON.stringify(vis));
}
function restoreColumnVisibility(){
  const data=localStorage.getItem(STORAGE_KEY);if(!data)return;
  const vis=JSON.parse(data);
  Object.keys(vis).forEach(k=>gridOptions.columnApi.setColumnVisible(k,vis[k]));
}

/* âœ… ëª¨ë‹¬ */
function openModal(encoded){
  const row=JSON.parse(decodeURIComponent(encoded));
  const m=document.getElementById("issueModal");
  const body=document.getElementById("issueBody");
  const html=`<table>
  <tr><th>CODE</th><td>${row.CODE}</td></tr>
  <tr><th>í”„ë¡œì íŠ¸ëª…</th><td>${row.PJTëª…}</td></tr>
  <tr><th>PM</th><td>${row.PM}</td></tr>
  <tr><th>ì‚¬ì—…ë¶€ì„œ</th><td>${row.ì‚¬ì—…ë¶€ì„œ}</td></tr>
  <tr><th>ë°œì£¼ì²˜</th><td>${row.ë°œì£¼ì²˜}</td></tr>
  <tr><th>ê³„ì•½ê¸°ê°„</th><td>${row.ê³„ì•½ì‹œì‘ì¼} ~ ${row.ê³„ì•½ì¢…ë£Œì¼}</td></tr>
  <tr><th>ê³„ì•½ê¸ˆì•¡</th><td>${row.ê³„ì•½ê¸ˆì•¡}</td></tr>
  <tr><th>ëˆ„ê³„ì²­êµ¬/ìˆ˜ê¸ˆ</th><td>${row.ëˆ„ê³„ì²­êµ¬} / ${row.ëˆ„ê³„ìˆ˜ê¸ˆ}</td></tr>
  <tr><th>ì§„ë„ìœ¨</th><td>${row.ì§„ë„ìœ¨}</td></tr>
  <tr><th>ìƒíƒœ</th><td>${row.ìƒíƒœ}</td></tr>
  <tr><th>ë¹„ê³ </th><td>${row.ë¹„ê³ }</td></tr>
  </table>`;
  body.innerHTML=html;m.classList.add("active");
}
function closeModal(){document.getElementById("issueModal").classList.remove("active");}

/* âœ… Grid ì‹¤í–‰ + LNB */
document.addEventListener("DOMContentLoaded",()=>new agGrid.Grid(document.getElementById("myGrid"),gridOptions));
document.getElementById("menuToggle").addEventListener("click",()=>{
  document.getElementById("sidebar").classList.toggle("active");
  document.getElementById("overlay").classList.toggle("active");
});
document.getElementById("overlay").addEventListener("click",()=>{
  document.getElementById("sidebar").classList.remove("active");
  document.getElementById("overlay").classList.remove("active");
});
</script>
</body>
</html>
